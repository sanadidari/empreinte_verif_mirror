name: Auto Repair â€” v5.0

on:
  push:
    branches: [ "main" ]
  workflow_dispatch: {}

jobs:
  detect-and-repair:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with: { fetch-depth: 0 }

      - name: Set up Node
        uses: actions/setup-node@v4
        with: { node-version: '18' }

      - name: Install Flutter
        uses: subosito/flutter-action@v2
        with: { flutter-version: '3.27.0' }

      - name: Ensure scripts executable
        run: chmod +x .github/scripts/auto_repair.sh || true

      - name: Run Auto Repair (analysis + suggestions)
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          AUTO_MERGE_TOKEN: ${{ secrets.AUTO_MERGE_TOKEN }}
          DOMAIN: qrpruf.sanadidari.com
        run: ./.github/scripts/auto_repair.sh
